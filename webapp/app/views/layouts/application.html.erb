<!DOCTYPE html>
<!--[if IE]><![endif]-->
<!--[if lt IE 7]> <html class="ie ie6" lang="en" xmlns:fb="http://ogp.me/ns/fb#" xmlns:ng="http://angularjs.org" ng-app="app" id="app"> <![endif]-->
<!--[if IE 7]> <html class="ie ie7" lang="en" xmlns:fb="http://ogp.me/ns/fb#"    xmlns:ng="http://angularjs.org" ng-app="app" id="app"> <![endif]-->
<!--[if IE 8]> <html class="ie ie8" lang="en" xmlns:fb="http://ogp.me/ns/fb#"    xmlns:ng="http://angularjs.org" ng-app="app" id="app"> <![endif]-->
<!--[if IE 9]> <html class="ie ie9" lang="en" xmlns:fb="http://ogp.me/ns/fb#"    xmlns:ng="http://angularjs.org" ng-app="app" id="app"> <![endif]-->
<!--[if !IE]><!--> <html lang="en" xmlns:ng="http://angularjs.org" ng-app="app" id="app"> <!--<![endif]-->
<head>
  <!-- http://docs.angularjs.org/guide/ie -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- CSS DIFF -->
  <meta name="viewport" content="width=1200">

  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">

  <meta name="apple-itunes-app" content="app-id=719879920">

  <%
    title = @page_title || 'Fair Market Fantasy'
    description = @page_description || 'Fair Market Fantasy is the fairest fantasy sports gaming website out there'
    keywords = @page_keywords || ''
    tagline = "The fair market fantasy game!"
  %>
  <title><%= title %></title>

  <!-- TODO: Fill in the og goodness -->
  <!-- og: == 'Open Graph Protocol' - Makes you Facebook "Like" Button & Sharing Friendly -->
  <meta name="title" content="<%= title %>" property="og:title" />
  <meta name="og:type" content="<%= @og_type || '' %>" property="og:type" />
  <meta name="og:url" content="<%= @og_url || '' %>" property="og:url" />
  <meta name="og:image" content="<%= @og_image || '' %>" property="og:image" />
  <meta name="og:site_name" content="<%= @og_site || '' %>" property="og:site_name" />
  <meta name="fb:app_id" content="<%= nil %>" property="fb:app_id" />
  <meta name="fb:admins" content="" property="fb:admins" />
  <meta name="description" content="<%= description %>" property="og:description" />
  <meta name="copyright" content="MustWin, LLC" />
  <meta name="author" content="MustWin, LLC" />

  <!-- SEO -->
  <meta name="description" content="<%= description %>"/>
  <meta name="keywords" content="<%= keywords %>"/>

  <%= csrf_meta_tags %>
  <%= stylesheet_link_tag "application", "flat-ui", "fonts", "fmf", :media => "all" %>

  <!-- TODO: make these icons -->
  <link rel="shortcut icon" href="<%= asset_path 'favicon.png' %>"/>
  <link rel="apple-touch-icon" href="<%= asset_path 'favicon.png' %>"/>

  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body ng-controller="ApplicationController">
<!-- FB SHIT -->
<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    // init the FB JS SDK
    FB.init({
      appId      : '<%= FACEBOOK_APP_ID %>',             // App ID from the app dashboard
      status     : true,                                 // Check Facebook Login status
      xfbml      : true                                  // Look for social plugins on the page
    });

    // Additional initialization code such as adding Event Listeners goes here
  };

  // Load the SDK asynchronously
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/all.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<!-- GA SHIT -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46242308-1', 'fairmarketfantasy.com');
  //ga('send', 'pageview'); // Handled by angulartics http://luisfarzati.github.io/angulartics/

</script>

  <div flash-alert active-class="alert in" class="fixed-flash fade " ng-cloak>
    <div class="container">
      <div class="row">
        <div class="span12">
          <strong class="alert-heading"></strong>
          <span class="alert-message">{{flash.message}}</span>
        </div>
      </div>
    </div>
  </div>  
  <!-- This is where you work your magic, do your best! -->
  <header class="full">
    <div class="container">
    <div class="row top-nav">
      <div class="span8">
        <a href="/#"><h1 class="logo-font">Fair Market <span class="logo-slash">Fantasy</span></h1></a> 
        <!--<span class="sub-title">Only available here, Play the NFL Playoffs!</span>-->
      </div>
      <div class="span4">
        <ul class="nav nav-pills blue-pills modal-pills" ng-cloak>
          <li ng-repeat="sport in sports" ng-class="{active: currentUser.currentSport == sport.name}">
            <a ng-show="sport.is_active" href="/#/{{sport.name}}/home">{{sport.name}}</a>
            <a ng-hide="sport.is_active" href="/#/{{sport.name}}/coming-soon">{{sport.name}}</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
    <div class="container">

    <div class="row header-bottom">
      <div class="span3 user-container text-center" ng-cloak>
        <div class="clearfix user-box">
          <img ng-src="{{currentUser.image_url}}" class='user-avatar'/>
          <div class="user-info">
            <span class="user-name">{{ currentUser.username || currentUser.name }}</span>
            <a href="javascript://" class='txt-white txt-red-hover' ng-click="settingsModal()">My Account</a><br />
            <%= link_to 'sign out', destroy_user_session_path, class: 'user-logout txt-red-hover' %>
          </div>
        </div>
        <div class="user-dash clearfix">
          <div class="user-balance no-border">
            <small>Cash:</small>&nbsp;&nbsp;{{ currentUser.balance | centsToDollars }}
          </div>
          <div class="user-balance no-border">
            <img class="nmw-info" src="<%= asset_path "info-icon.png" %>" width="17px"
              popover-trigger="mouseenter" popover="Fanbucks are how much you're up or down this month. Any positive balance is put in your account each month. Check out the FAQs for more info!" popover-placement="right">
            <small>FanBucks:</small>&nbsp;&nbsp;{{ currentUser.customer_object.net_monthly_winnings | centsToDollars }}
          </div>
          <div class="user-dash no-border clearfix">
            <a class="btn btn-small btn-success" href="javascript://" ng-click="addFundsModal()">Manage Subscription</a>
          </div>
       </div>
      </div>
    </div>
    </div>
  </header>
  
  <article>
    <div class="container">
      <div class="row">
        <div class="span3 user-navigation">
          <ul class="nav">
            <li class="nav-item"><a href="/#/{{currentUser.currentSport}}/home">Home</a></li>
            <li class="nav-item nav-item-highlight" ng-show="sportHasPlayoffs()"><a href="/#/{{currentUser.currentSport}}/playoffs">Play the Playoffs</a></li>
            <li class="nav-item"><a href="/#/{{currentUser.currentSport}}/rosters">My Contests</a></li>
            <li class="nav-item"><a href="/#/{{currentUser.currentSport}}/history">History</a></li>
            <li class="nav-item hide"><a href="/#/leaderboard">Leaderboards</a></li>
            <li class="nav-item"><a href="/#/{{currentUser.currentSport}}/rules" >Rules and Scoring</a></li>
            <li class="nav-item"><a href="/#/legal" >Legal Info</a></li>
            <li class="nav-item"><a href="/#/support">Support</a></li>
            <li class="nav-item end"><a href="javascript://" ng-click="withdrawFundsModal()">Cash Out</a></li>
          </ul>
          <div class="nav-mobile-app-links">
            <a href="https://itunes.apple.com/us/app/fmf-football/id719879920?mt=8&uo=4" target="itunes_store" class="ios-app-link" style=""></a>
          </div>
        </div>
        <div class="span9 page-content">
          <div class="padded-content">
            <div class="content">
              <div id="content" ng-view>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="container">
        <div class="row">
          <div class="span4">
            <h4 class="logo-font">Fair Market <span class="logo-slash">Fantasy</span></h4>
            <p>Copyright 2013, Fair Market Fantasy, LLC. All Rights Reserved.</p>
            <p>Designed and developed by <a href="http://mustw.in">Must Win</a></p>
            <p>Based in San Francisco, CA</p>
          </div>
          <div class="span3 offset5 tos-padding">
            <p><a href="#/terms">Terms and Conditions</a></p>
            <p><a href="#/legal">US &amp; Canada Legality</a></p>
            <p><a href="#/support">Customer Support / Contact</a></p>
            <p><a href="javascript://" ng-click="withdrawFundsModal()">Cash Out</a></p>

          </div>
        </div>
      </div>
    </footer>
  </article>


<!-- Setup some handy globals -->
<script type="text/javascript">
  window.App = {
    site: "<%= SITE %>",
    currentUser: <%= (UserSerializer.new(current_user, scope: current_user).to_json.html_safe) || 'null' %>,
    isUserAdmin: <%= current_user && current_user.admin? || false %>
  };

window.App.sports = <%= Sport.all.map{|s| SportSerializer.new(s, scope: current_user) }.to_json.html_safe %>;

  window.setCurrentUser = function(user) {
    window.App.currentUser = user;
  };
  window.refreshUser = function(amount) {
    angular.element('body').injector().get('currentUserService').refreshUser();
  };
  window.addToBalance = function(amount) {
    window.App.currentUser.balance = window.App.currentUser.balance + amount;
    var $scope = $('body').scope();
    $scope.$emit('user-changed');
  };
  window.addToTokenBalance = function(amount) {
    window.App.currentUser.token_balance = window.App.currentUser.token_balance + amount;
    var $scope = $('body').scope();
    $scope.$emit('user-changed');
  };
</script>


<%= render :partial => 'templates/ng_includes' %>
<%= javascript_include_tag "application" %>

<%= yield :javascript %>

</body>
</html>
<!-- Another #winning product brought to you by MustWin! http://mustw.in -->

