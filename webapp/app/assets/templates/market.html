<div ng-controller="MarketController">
  <h2>Contests on {{day(market.closed_at)}}</h2>

  <h3>Games</h3>
  <ul>
    <li ng-repeat="game in games">
      {{game.away_team}} @ {{game.home_team}}
    </li>
  </ul>
  <div ng-hide="roster">
    <h3>Contests</h3>
    <ul>
      <!-- all these ng-clicks to joinContest, need to pass in  contest_type_id
          instead of the string '100k' or '970' or '194', etc-->
      <li ng-repeat="(contestClass, contestTypes) in contestClasses">
        <h2>{{contestClass}}</h2>
        <ul class="contests">
          <li ng-repeat="contestType in contestTypes">
            <a href="javascript://" ng-click="joinContest(contestType)">{{ contestType.buy_in | freeIfZero }}</a>
          </li>
        </ul>
      </li>
    </ul>
  </div>

  <div ng-controller="RosterController" ng-show="roster">
    <a href="javascript://" ng-click="deleteRoster()">Cancel entry</a>
    <ul>
      <li><a href="javascript://" ng-click="filter = 'my-players'">My players</a></li>
      <li><a href="javascript://" ng-click="filter = 'positions'">Positions</a></li>
      <li><a href="javascript://" ng-click="filter = 'games'">Games</a></li>
    </ul>
    <ul>
      <li ng-show="filter == 'positions'">
        <ul>
          <li ng-repeat="position in uniqPositionList">
            <a ng-click="filterPlayers({position: position})" href="javascript://">{{position}}</a>
          <li>
        </ul>
      </li>
      <li ng-show="filter == 'games'">
        <!-- TODO: make this a dropdown -->
        <select ng-options="game as gameFromTeam(game.home_team) for game in games" ng-model="game" ng-change="filterPlayers({game: game.id})">
        </select>
      </li>
    </ul>

    <h2>Players</h2>
    
    <table>
      <thead>
        <tr>
          <th ng-click="sort('status')">Status</th>
          <th ng-click="sort('name')">Name</th>
          <th ng-click="sort('position')">Position</th>
          <th ng-click="sort('game')">Game</th>
          <th ng-click="sort('ppg')">PPG</th>
          <th ng-click="sort('salary')">Salary</th>
          <th>Add</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="player in players | filter:notInRoster">
          <td>{{player.status}}</td>
          <td>{{player.name}}</td>
          <td>{{player.position}}</td>
          <td>{{gameFromTeam(player.team.Abbrev)}}</td>
          <td>{{player.ppg}}</td>
          <td>{{player.buy_price}}</td>
          <td><a href="javascript://" ng-click="addPlayer(player)">Add</a></td>
        </tr>
      </tbody>
    </table>
  
    <h2>Roster</h2>
    <p>Remaining Salary: {{roster.remaining_salary}}</p>
    <table>
      <thead>
        <tr>
          <th>Position</th>
          <th>Name</th>
          <th>Game</th>
          <th>PPG</th>
          <th>Purchase Price</th>
          <th>Price Differential</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="player in roster.players">
          <td>{{player.position}}</td>
          <td>{{player.name}}</td>
          <td>{{player.game}}</td>
          <td>{{player.ppg}}</td>
          <td>{{player.purchase_price | emptyIfZero }}</td>
          <td>{{player.sell_price - player.purchase_price }}</td>
          <td><a ng-show="player.id" href="javascript://" ng-click="removePlayer(player)">Remove</a></td>
        </tr>
      </tbody>
    </table>
    <a ng-click="submitRoster()" href="javascript://" ng-show="isValidRoster() && roster.state == 'in_progress'">Submit this roster</a>
  </div>
</div>
