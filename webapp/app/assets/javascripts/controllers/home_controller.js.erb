angular.module("app.controllers")
.controller('HomeController', ['$scope', 'rosters', 'markets', '$dialog', '$location', function($scope, rosters, markets, $dialog, $location) {
  $scope.rosters = rosters;
  if ($scope.currentUser) {
    rosters.fetchMine();
    rosters.fetchPastStats();
    rosters.setPoller(function() { rosters.fetchMine(); }, <%= Rails.env == 'development' ? 30000 : 10000 %>);

    // Force them to set a user!
    if (_.isEmpty($scope.currentUser.username)) {
      var dialogOpts = {
            backdrop: true,
            keyboard: false,
            backdropClick: false,
            dialogClass: 'modal',
            templateUrl: '/add_username_modal.html',
            controller: 'UserNameController'
          };
      var d = $dialog.dialog(dialogOpts);
      d.open();
    }

    $scope.markets = markets;
  }

  $scope.showNextLeagueRoster = function(league) {
    $scope.fs.contests.join_league(league.id).then(function(data){
      rosters.selectRoster(data);
      $location.path('/arket/' + data.market.id + '/roster/' + data.id);
    });
  };

  //$scope.$watch('league')

}]);

