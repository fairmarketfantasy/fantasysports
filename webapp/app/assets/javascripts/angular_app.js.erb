angular.module('app', [
      'app.services',
      'app.data',
      'app.directives',
      'app.filters',
      'app.controllers',
      'app.templates',
      'angular-flash.service',
      'angular-flash.flash-alert-directive',
      'ui.bootstrap'])
.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
    $routeProvider.
      when('/', {templateUrl: '<%= path_to_asset("home.html") %>', controller: 'HomeController'}).
      when('/market/:market_id/roster/:roster_id', {templateUrl: '<%= path_to_asset("roster.html") %> ', controller: 'RosterController'}).
      when('/market/:market_id', {templateUrl: '<%= path_to_asset("home.html") %> ', controller: 'HomeController'}).
      when('/account', {templateUrl: '<%= path_to_asset("account.html") %>', controller: 'AccountController'}).
    //...
      otherwise({redirectTo: '/'});
  }])
.run(['$rootScope', '$location', 'rosters', 'flash', function($rootScope, $location, rosters, flash) {
    // register listener to watch route changes
    $rootScope.$on( "$routeChangeSuccess", function(event, next, current) {
      var roster = rosters.inProgressRoster;
      if (roster) {
        var path = '/market/' + roster.market_id + '/roster/' + roster.id;
        if (path != $location.path()) {
          flash.success = "Looks like you already have a roster going.  Let's finish entering!";
          $location.path(path).replace();
          rosters.selectRoster(roster);
        }
      }
      return true;
    });
 }])
