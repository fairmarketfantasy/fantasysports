<div ng-controller="MarketController">
  <h2>Contests on {{day(market.closed_at)}}</h2>

  <h3>Games</h3>
  <ul>
    <li ng-repeat="game in games">
      {{game.away_team}} @ {{game.home_team}}
    </li>
  </ul>
  <div ng-hide="roster">
    <h3>Contests</h3>
    <ul>
      <li class="contest_type">
        <h2><a ng-click="joinContest('100k', 10)">100k</a></h2>
      </li>
      <li class="contest_type">
        <h2>970s</h2>
        <ul class="contests">
          <li><a href="javascript://" ng-click="joinContest('970', 0)">Free</a></li>
          <li><a href="javascript://" ng-click="joinContest('970', 2)">$2</a></li>
          <li><a href="javascript://" ng-click="joinContest('970', 10)">$10</a></li>
        </ul>
      </li>
      <li class="contest_type">
        <h2>194s</h2>
        <ul class="contests">
          <li><a href="javascript://" ng-click="joinContest('194', 0)">Free</a></li>
          <li><a href="javascript://" ng-click="joinContest('194', 2)">$2</a></li>
          <li><a href="javascript://" ng-click="joinContest('194', 10)">$10</a></li>
        </ul>
      </li>
      <li class="contest_type">
        <h2>H2H</h2>
        <ul class="contests">
          <li><a href="javascript://" ng-click="joinContest('h2h', 0)">Free</a></li>
          <li><a href="javascript://" ng-click="joinContest('h2h', 2)">$2</a></li>
          <li><a href="javascript://" ng-click="joinContest('h2h', 10)">$10</a></li>
        </ul>
      </li>
      <li class="contest_type">
      <h2><a ng-click="createH2H()">Challenge a friend to a H2H</a></h2>
      </li>
    </ul>
  </div>

  <div ng-controller="RosterController" ng-show="roster">
    <a href="javascript://" ng-click="deleteRoster()">Cancel entry</a>
    <ul>
      <li><a href="javascript://" ng-click="filter = 'my-players'">My players</a></li>
      <li><a href="javascript://" ng-click="filter = 'positions'">Positions</a></li>
      <li><a href="javascript://" ng-click="filter = 'games'">Games</a></li>
    </ul>
    <ul>
      <li ng-show="filter == 'positions'">
        <ul>
          <li ng-repeat="position in positionList">
            <a ng-click="filterPlayers({position: position})" href="javascript://">{{position}}</a>
          <li>
        </ul>
      </li>
      <li ng-show="filter == 'games'">
        <!-- TODO: make this a dropdown -->
        <select ng-options="game as gameFromTeam(game.home_team) for game in games" ng-model="game" ng-change="filterPlayers({game: game.id})">
        </select>
      </li>
    </ul>

    <h2>Players</h2>
    
    <table>
      <thead>
        <tr>
          <th ng-click="sort('status')">Status</th>
          <th ng-click="sort('name')">Name</th>
          <th ng-click="sort('position')">Position</th>
          <th ng-click="sort('game')">Game</th>
          <th ng-click="sort('ppg')">PPG</th>
          <th ng-click="sort('salary')">Salary</th>
          <th>Add</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="player in players | filter:notInRoster">
          <td>{{player.status}}</td>
          <td>{{player.name}}</td>
          <td>{{player.position}}</td>
          <td>{{gameFromTeam(player.team.Abbrev)}}</td>
          <td>{{player.ppg}}</td>
          <td>{{player.salary}}</td>
          <td><a href="javascript://" ng-click="addPlayer(player)">Add</a></td>
        </tr>
      </tbody>
    </table>
  
    <h2>Roster</h2>
    <p>Remaining Salary: {{roster.remaining_salary}}</p>
    <table>
      <thead>
        <tr>
          <th>Position</th>
          <th>Name</th>
          <th>Game</th>
          <th>PPG</th>
          <th>Purchase Price</th>
          <th>Price Differential</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="player in roster.players">
          <td>{{player.position}}</td>
          <td>{{player.name}}</td>
          <td>{{player.game}}</td>
          <td>{{player.ppg}}</td>
          <td>{{player.purchase_price | emptyIfZero }}</td>
          <td>{{player.salary - roster.players[position].purchase_price | emptyIfZero }}</td>
          <td><a ng-show="player.id" href="javascript://" ng-click="removePlayer(player)">Remove</a></td>
        </tr>
      </tbody>
    </table>
  
  </div>
</div>
